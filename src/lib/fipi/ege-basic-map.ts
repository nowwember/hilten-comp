type MapEntry = { title: string; subtopics: string[] }

export const EGE_BASIC_MAP: Record<number, MapEntry> = (() => {
  const toSlug = (input: string): string => {
    const map: Record<string, string> = {
      а: 'a', б: 'b', в: 'v', г: 'g', д: 'd', е: 'e', ё: 'e', ж: 'zh', з: 'z', и: 'i', й: 'y', к: 'k', л: 'l', м: 'm', н: 'n', о: 'o', п: 'p', р: 'r', с: 's', т: 't', у: 'u', ф: 'f', х: 'h', ц: 'c', ч: 'ch', ш: 'sh', щ: 'shch', ъ: '', ы: 'y', ь: '', э: 'e', ю: 'yu', я: 'ya'
    };
    const lower = input.toLowerCase();
    let out = '';
    for (const ch of lower) {
      if (/[a-z0-9]/.test(ch)) { out += ch; continue; }
      if (map[ch] != null) { out += map[ch]; continue; }
      if (/\d/.test(ch)) { out += ch; continue; }
      out += '-';
    }
    out = out.replace(/[^a-z0-9]+/g, '-').replace(/-+/g, '-').replace(/^-|-$/g, '');
    return out;
  };

  const make = (n: number, title: string, topics: string[]): [number, MapEntry] => [
    n,
    {
      title: `Задание ${n}. ${title}`,
      subtopics: topics.map(toSlug)
    }
  ];

  return Object.fromEntries< MapEntry >([
    make(1, 'Простейшие текстовые задачи', ['округление с недостатком', 'округление с избытком', 'разные задачи']),
    make(2, 'Размеры и единицы измерения', ['время', 'длина', 'масса', 'объём', 'площадь', 'различные единицы']),
    make(3, 'Чтение графиков и диаграмм', ['величина по графику', 'величина по диаграмме']),
    make(4, 'Преобразования выражений', ['формулы с большим числом переменных', 'с одной/двумя переменными', 'с тремя переменными']),
    make(5, 'Начала теории вероятностей', ['классическое определение вероятности', 'теоремы о вероятностях событий']),
    make(6, 'Выбор оптимального варианта', ['подбор комплекта или комбинации', 'выбор из 2/3/4 возможных']),
    make(7, 'Анализ графиков и диаграмм', ['анализ графиков функций', 'скорость изменения величин']),
    make(8, 'Анализ утверждений', ['анализ утверждений']),
    make(9, 'Задачи на квадратной решётке', ['задачи на карте', 'план местности', 'трапеция', 'треугольник', 'ромб', 'произвольный четырёхугольник']),
    make(10, 'Прикладная геометрия', ['разные задачи', 'квадрат', 'окружность', 'трапеция', 'треугольник', 'прямоугольник']),
    make(11, 'Прикладная стереометрия', ['многогранники (рёбра/грани)', 'куб', 'прямоугольный параллелепипед', 'призма', 'пирамида', 'площадь поверхности составного', 'объём составного', 'круглые тела']),
    make(12, 'Планиметрия', ['треугольники', 'четырёхугольники', 'многоугольники', 'окружность']),
    make(13, 'Задачи по стереометрии', ['параллелепипед', 'призма', 'пирамида', 'цилиндр', 'конус', 'шар']),
    make(14, 'Вычисления', ['десятичные дроби', 'разные задачи', 'обыкновенные дроби']),
    make(15, 'Простейшие текстовые задачи', ['проценты', 'округление']),
    make(16, 'Вычисления и преобразования', ['со степенями', 'числовые иррациональные выражения', 'числовые логарифмические', 'вычисление тригонометрических', 'преобразования тригонометрических']),
    make(17, 'Простейшие уравнения', ['линейные/квадратные/кубические', 'иррациональные', 'показательные', 'логарифмические']),
    make(18, 'Неравенства', ['решение неравенств', 'числовые промежутки']),
    make(19, 'Числа и их свойства', ['цифровая запись числа']),
    make(20, 'Текстовые задачи', ['проценты/смеси/сплавы', 'движение по прямой/окружности/воде', 'совместная работа', 'прогрессии']),
    make(21, 'Задачи на смекалку', ['задачи о числах', 'планиметрия', 'текстовые задачи'])
  ]);
})();

export function eachDesiredPick(perSubtopic: number = 2): Array<{ taskNo: number; subtopic: string; wanted: number }> {
  const picks: Array<{ taskNo: number; subtopic: string; wanted: number }> = [];
  for (const [key, entry] of Object.entries(EGE_BASIC_MAP)) {
    const taskNo = parseInt(key, 10);
    for (const sub of entry.subtopics) {
      picks.push({ taskNo, subtopic: sub, wanted: perSubtopic });
    }
  }
  return picks;
}


